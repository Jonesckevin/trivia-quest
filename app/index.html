<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${APP_TITLE}</title>
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="logo.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <span class="hamburger"></span>
    </button>

    <!-- Left Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Host Controls</h2>
        </div>
        
        <div class="sidebar-content">
            <!-- Game Mode -->
            <section class="control-section" data-section="game-mode">
                <h3>Game Mode</h3>
                <div class="section-content">
                    <div class="button-group">
                        <button class="btn btn-primary" id="singleModeBtn">Single Questions</button>
                        <button class="btn btn-secondary" id="jeopardyModeBtn">Jeopardy Board</button>
                    </div>
                </div>
            </section>

            <!-- Team Setup -->
            <section class="control-section collapsed" data-section="teams">
                <h3>Teams</h3>
                <div class="section-content">
                    <div class="form-group">
                        <label for="teamCount">Number of Teams</label>
                        <select id="teamCount">
                            <option value="1">1 (Solo Mode)</option>
                            <option value="2">2 Teams</option>
                            <option value="3">3 Teams</option>
                            <option value="4">4 Teams</option>
                        </select>
                    </div>
                    <div class="team-names-header">
                        <small>Click names below to edit:</small>
                    </div>
                    <div id="teamNames" class="team-names"></div>
                </div>
            </section>

            <!-- Points Settings -->
            <section class="control-section collapsed" data-section="points">
                <h3>Points</h3>
                <div class="section-content">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="usePointValues">
                            Use difficulty-based points
                        </label>
                    </div>
                    <div id="pointSettings" class="point-settings">
                        <div class="form-group">
                            <label for="l1Points">Base Points (Row 1)</label>
                            <input type="number" id="l1Points" value="100" min="1">
                        </div>
                        <div class="form-group">
                            <label for="l2Points">L2 Multiplier Points</label>
                            <input type="number" id="l2Points" value="200" min="1">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Jeopardy Board Settings -->
            <section class="control-section collapsed" data-section="jeopardy-board">
                <h3>Jeopardy Board</h3>
                <div class="section-content">
                    <div class="form-group">
                        <label for="jeopardyRows">
                            Number of Rows <span id="maxRowsInfo" class="max-rows-info">(max: 5)</span>
                        </label>
                        <input type="number" id="jeopardyRows" value="5" min="1" max="10">
                    </div>
                    <div class="form-group">
                        <label for="pointLabel">Point Label <small>(max 3 chars)</small></label>
                        <input type="text" id="pointLabel" value="" maxlength="3" placeholder="e.g., PTs, MVs, $">
                        <small>Leave empty for default ($100, $200...)</small>
                    </div>
                    <div class="form-group">
                        <label for="pointImageUrl">Custom Point Image URL</label>
                        <input type="text" id="pointImageUrl" value="logo.svg" placeholder="logo.svg (default)">
                        <small>Default: logo.svg - Change image mode to use</small>
                    </div>
                    <div class="form-group">
                        <label for="pointImageMode">Image Display Mode</label>
                        <select id="pointImageMode">
                            <option value="none">No Image (Text Only)</option>
                            <option value="replace">Replace Point Text</option>
                            <option value="fullcell">Full Cell Background</option>
                        </select>
                    </div>
                    <div class="form-group image-preview-group hidden" id="imagePreviewGroup">
                        <label>Preview:</label>
                        <div class="image-preview-box">
                            <img id="pointImagePreview" src="" alt="Preview">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Feedback & Sound -->
            <section class="control-section collapsed" data-section="effects">
                <h3>Effects</h3>
                <div class="section-content">
                    <div class="form-group">
                        <label for="answerDifficulty">Answer Difficulty</label>
                        <select id="answerDifficulty">
                            <option value="easy">Easy (4 choices)</option>
                            <option value="medium">Medium (6 choices)</option>
                            <option value="hard">Hard (8 choices)</option>
                        </select>
                        <small>Controls how many answer options are shown</small>
                    </div>
                    <div class="form-group">
                        <label for="questionOrder">Question Order</label>
                        <select id="questionOrder">
                            <option value="ordered" selected>Ordered (by import)</option>
                            <option value="randomized">Randomized</option>
                        </select>
                        <small>Single: follows order. Jeopardy: category order</small>
                    </div>
                    <div class="form-group">
                        <label for="feedbackIntensity">Feedback Intensity</label>
                        <select id="feedbackIntensity">
                            <option value="low">Low (Border only)</option>
                            <option value="medium">Medium (Color pulse)</option>
                            <option value="full" selected>Full (Dramatic)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="volumeSlider">Sound Volume</label>
                        <div class="volume-control">
                            <span class="volume-icon" id="volumeIcon">üîä</span>
                            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="50">
                            <span class="volume-label" id="volumeLabel">50%</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Question Management -->
            <section class="control-section" data-section="questions">
                <h3>Questions</h3>
                <div class="section-content">
                    <div class="button-group">
                        <button class="btn btn-accent" id="loadSampleBtn">Load Sample Questions</button>
                        <button class="btn btn-primary" id="browseServerBtn">üìö Browse Server Categories</button>
                        <button class="btn btn-secondary" id="importBtn">Import JSONL</button>
                        <button class="btn btn-secondary" id="exportBtn">Export JSONL</button>
                    </div>
                    <input type="file" id="importFile" accept=".jsonl" hidden>
                    <button class="btn btn-secondary" id="openAddQuestionBtn" style="margin-top: 0.5rem; width: 100%;">+ Add Question</button>
                </div>
            </section>

            <!-- Reset -->
            <section class="control-section" data-section="reset">
                <h3>Reset</h3>
                <div class="section-content">
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="btn btn-info" id="resetQuestionsBtn" style="flex: 1;">Reset Questions</button>
                        <button class="btn btn-warning" id="resetScoresBtn" style="flex: 1;">Reset Scores</button>
                    </div>
                    <button class="btn btn-danger" id="resetBtn" style="margin-top: 0.5rem; width: 100%;">Reset All Data</button>
                </div>
            </section>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Header -->
        <header class="game-header">
            <div class="logo-title">
                <img src="logo.svg" alt="MV Logo" class="header-logo">
                <h1 class="game-title">${APP_TITLE}</h1>
            </div>
            <div class="question-counter" id="questionCounter" aria-live="polite" aria-atomic="true">
                <span class="counter-number" id="remainingCount">0</span>
                <span class="counter-label">questions remaining</span>
            </div>
        </header>

        <!-- Single Question Mode -->
        <section class="game-area single-mode" id="singleMode">
            <div class="question-card" id="questionCard">
                <div class="question-meta">
                    <span class="category-badge" id="currentCategory">Category</span>
                    <span class="difficulty-badge" id="currentDifficulty">L1</span>
                    <span class="points-badge" id="currentPoints">100 pts</span>
                </div>
                <p class="question-text" id="questionText">Press "Next Question" to start!</p>
                <div class="answers-grid" id="answersGrid"></div>
                <div class="question-actions" id="questionActions">
                    <button class="btn btn-primary" id="nextQuestionBtn">Next Question</button>
                    <button class="btn btn-secondary" id="skipQuestionBtn" disabled>Skip Question</button>
                </div>
                <div class="question-actions hidden" id="singleAwardSection">
                    <span class="award-label" id="singleAwardLabel">Award points to:</span>
                    <div class="award-buttons" id="singleAwardButtons"></div>
                    <button class="btn btn-secondary" id="singleNoPointsBtn">Skip / No Points</button>
                </div>
            </div>
        </section>

        <!-- Jeopardy Mode -->
        <section class="game-area jeopardy-mode hidden" id="jeopardyMode">
            <div class="jeopardy-board" id="jeopardyBoard"></div>
        </section>

        <!-- Question Modal (for Jeopardy) -->
        <div class="modal-overlay hidden" id="questionModal" role="dialog" aria-modal="true" aria-labelledby="modalQuestionText">
            <div class="modal-content">
                <div class="question-meta">
                    <span class="category-badge" id="modalCategory">Category</span>
                    <span class="difficulty-badge" id="modalDifficulty">L1</span>
                    <span class="points-badge" id="modalPoints">100 pts</span>
                </div>
                <p class="question-text" id="modalQuestionText">Question goes here</p>
                <div class="answers-grid" id="modalAnswersGrid"></div>
                <div class="modal-award-section hidden" id="modalAwardSection">
                    <span class="award-label" id="modalAwardLabel">Award points to:</span>
                    <div class="award-buttons" id="modalAwardButtons"></div>
                    <button class="btn btn-secondary" id="modalNoPointsBtn">Skip / No Points</button>
                </div>
                <div class="modal-actions" id="modalCloseSection">
                    <button class="btn btn-secondary" id="closeModalBtn">Close</button>
                </div>
            </div>
        </div>

        <!-- Add Question Modal -->
        <div class="modal-overlay hidden" id="addQuestionModal" role="dialog" aria-modal="true" aria-labelledby="addQuestionTitle">
            <div class="modal-content add-question-modal">
                <div class="add-question-header">
                    <h2 id="addQuestionTitle">Add Question</h2>
                    <button type="button" class="btn btn-secondary btn-small" id="bulkAddBtn">üìã Bulk Add</button>
                </div>
                
                <!-- Single Add Form -->
                <form id="addQuestionForm">
                    <div id="singleAddForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newCategory">Category</label>
                                <input type="text" id="newCategory" required placeholder="e.g., Science">
                            </div>
                            <div class="form-group">
                                <label for="newDifficulty">Difficulty</label>
                                <select id="newDifficulty" required>
                                    <option value="L1">L1 (Easy)</option>
                                    <option value="L2">L2 (Hard)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="newType">Question Type</label>
                            <select id="newType" required>
                                <option value="general">General Question (text input)</option>
                                <option value="multiple_choice" selected>Multiple Choice (1 correct answer)</option>
                                <option value="multiple_answer">Multiple Answer (select all correct)</option>
                                <option value="hidden">Hidden (reveal answer)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newQuestion">Question</label>
                            <textarea id="newQuestion" required placeholder="Enter your question..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="newDescription">Description / Notes <small>(optional)</small></label>
                            <textarea id="newDescription" placeholder="Additional notes or context for this question..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="newAnswers">Correct Answer(s) <small>(comma-separated for multiple)</small></label>
                            <input type="text" id="newAnswers" required placeholder="e.g., Paris, paris">
                        </div>
                        <div class="form-group" id="incorrectAnswersGroup">
                            <label for="newIncorrect">Incorrect Answers <small>(3-7, comma-separated)</small></label>
                            <input type="text" id="newIncorrect" placeholder="e.g., London, Berlin, Madrid, Rome, Vienna, Amsterdam, Brussels">
                        </div>
                        <div class="form-group hidden" id="regexGroup">
                            <label for="newRegex">Regex Pattern</label>
                            <div class="regex-template-row">
                                <select id="regexTemplate">
                                    <option value="">Custom pattern...</option>
                                    <option value="number">Number (exact match)</option>
                                    <option value="numberOrWord">Number or Word (e.g., 4 or four)</option>
                                    <option value="year">Year (e.g., 1993)</option>
                                    <option value="port">Port (optional "port" prefix)</option>
                                    <option value="level">Level (optional "level" prefix)</option>
                                    <option value="caseInsensitive">Case-insensitive match</option>
                                    <option value="contains">Contains text</option>
                                </select>
                            </div>
                            <input type="text" id="newRegex" placeholder="e.g., ^(4|four)$">
                            <small>Pattern to validate user input (case-insensitive)</small>
                        </div>
                        <div class="form-group hidden" id="regexDescGroup">
                            <label for="newRegexDescription">Regex Hint <small>(shown to user)</small></label>
                            <input type="text" id="newRegexDescription" placeholder="e.g., Enter the number as a digit or word">
                        </div>
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-primary">Add Question</button>
                            <button type="button" class="btn btn-secondary" id="closeAddQuestionBtn">Cancel</button>
                        </div>
                    </div>
                </form>
                
                <!-- Bulk Add Form -->
                <div id="bulkAddForm" class="hidden">
                    <div class="bulk-add-header">
                        <span>Category</span>
                        <span>Diff</span>
                        <span>Type</span>
                        <span>Question</span>
                        <span>Correct Answers</span>
                        <span>Incorrect Answers</span>
                        <span></span>
                    </div>
                    <div id="bulkAddRows" class="bulk-add-rows"></div>
                    <div class="bulk-add-actions">
                        <button type="button" class="btn btn-secondary" id="addBulkRowBtn">+ Add Row</button>
                        <button type="button" class="btn btn-primary" id="submitBulkBtn">Add All Questions</button>
                        <button type="button" class="btn btn-secondary" id="closeAddQuestionBtn2" onclick="document.getElementById('addQuestionModal').classList.add('hidden')">Cancel</button>
                    </div>
                    <small class="bulk-hint">üí° Compact form for adding multiple questions quickly. Max 10 at a time.</small>
                </div>
            </div>
        </div>

        <!-- Server Categories Modal -->
        <div class="modal-overlay hidden" id="categoriesModal" role="dialog" aria-modal="true" aria-labelledby="categoriesModalTitle">
            <div class="modal-content categories-modal">
                <div class="modal-header">
                    <h2 id="categoriesModalTitle">üìö Server Question Categories</h2>
                    <button class="btn btn-secondary btn-icon" id="closeCategoriesBtn" aria-label="Close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="categoriesLoading" class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading categories...</p>
                    </div>
                    <div id="categoriesError" class="error-state hidden">
                        <p class="error-icon">‚ö†Ô∏è</p>
                        <p class="error-message">Failed to load categories</p>
                        <button class="btn btn-secondary" id="retryLoadCategories">Retry</button>
                    </div>
                    <div id="categoriesList" class="categories-list hidden"></div>
                </div>
                <div class="modal-footer">
                    <div class="server-stats" id="serverStats"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Team Scoreboard -->
    <footer class="scoreboard hidden" id="scoreboard" aria-live="polite">
        <div class="scoreboard-inner" id="scoreboardInner" aria-label="Team scores"></div>
        <div class="award-points hidden" id="awardPoints">
            <span class="award-label">Award points to:</span>
            <div class="award-buttons" id="awardButtons"></div>
            <button class="btn btn-small btn-secondary" id="noPointsBtn">Skip / No Points</button>
        </div>
    </footer>

    <!-- GitHub Footer -->
    <div class="github-footer">
        <span class="footer-brand">Trivia Quest</span>
        <span class="footer-divider">|</span>
        <a href="https://github.com/jonesckevin/trivia-quest" target="_blank" rel="noopener noreferrer" class="github-link" title="View on GitHub">
            <svg class="github-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
            </svg>
            <span>GitHub</span>
        </a>
    </div>

    <script src="app.js"></script>
</body>
</html>
